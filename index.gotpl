<!DOCTYPE html>
<html lang="en">
<head>
    <title>fontl</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/script.js"></script>
    {{range .}}
    <style>
        {{safeCSS .CSS}}
    </style>
    {{end}}
</head>
<body>
    <header class="page-header">
        <h1>fontl</h1>
        <div class="header-buttons">
            <button id="previewBtn" class="header-btn">Preview Settings</button>
            <button id="uploadBtn" class="header-btn">Upload Font</button>
        </div>
    </header>
    
    <!-- Upload Dialog -->
    <dialog id="uploadDialog">
        <div class="dialog-header">
            <h2>Upload Font</h2>
            <button type="button" class="close-btn" aria-label="Close dialog">&times;</button>
        </div>
        <div class="upload-form">
        <form id="uploadForm" enctype="multipart/form-data" method="post" action="/upload">
            <div class="form-group">
                <label for="fontFile" class="form-label">Font File:</label>
                <input type="file" id="fontFile" name="fontFile" accept=".ttf,.otf,.woff,.woff2,.eot" required class="form-input">
            </div>
            <div class="form-group">
                <label for="fontName" class="form-label">Font Name:</label>
                <input type="text" id="fontName" name="fontName" placeholder="Leave empty to use filename" class="form-input">
            </div>
            <div class="form-group">
                <label for="source" class="form-label">Source:</label>
                <input type="text" id="source" name="source" placeholder="e.g., Google Fonts, Adobe, etc." class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Commercial Use:</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" id="commercialUseAllowed" name="commercialUse" value="true" class="form-radio">
                        Allowed
                    </label>
                    <label class="radio-label">
                        <input type="radio" id="commercialUseNotAllowed" name="commercialUse" value="false" class="form-radio">
                        Not allowed
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label for="projects" class="form-label">Projects (comma-separated):</label>
                <input type="text" id="projects" name="projects" placeholder="e.g., website, branding, print" class="form-input">
            </div>
            <div class="form-group">
                <label for="tags" class="form-label">Tags (comma-separated):</label>
                <input type="text" id="tags" name="tags" placeholder="e.g., serif, display, modern" class="form-input">
            </div>
            <button type="submit" class="upload-button">Upload Font</button>
        </form>
        <div id="uploadStatus" class="upload-status"></div>
        </div>
    </dialog>
    
    <!-- Preview Settings Dialog -->
    <dialog id="previewDialog">
        <div class="dialog-header">
            <h2>Preview Settings</h2>
            <button type="button" class="close-btn" aria-label="Close dialog">&times;</button>
        </div>
        <div class="preview-form">
            <div class="form-group">
                <label for="previewText" class="form-label">Example Text:</label>
                <input type="text" id="previewText" placeholder="The quick brown fox jumps over the lazy dog" class="form-input">
            </div>
            <div class="form-group">
                <label for="fontSize" class="form-label">Font Size: <span id="fontSizeValue">24px</span></label>
                <input type="range" id="fontSize" min="6" max="200" value="24" class="form-range">
            </div>
        </div>
    </dialog>
    
    <!-- Edit Font Dialog -->
    <dialog id="editDialog">
        <div class="dialog-header">
            <h2>Edit Font</h2>
            <button type="button" class="close-btn" aria-label="Close dialog">&times;</button>
        </div>
        <div class="edit-form">
        <form id="editForm" method="post" action="/edit">
            <input type="hidden" id="editFilename" name="filename">
            <div class="form-group">
                <label for="editFontName" class="form-label">Font Name:</label>
                <input type="text" id="editFontName" name="fontName" required class="form-input">
            </div>
            <div class="form-group">
                <label for="editSource" class="form-label">Source:</label>
                <input type="text" id="editSource" name="source" placeholder="e.g., Google Fonts, Adobe, etc." class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Commercial Use:</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" id="editCommercialUseAllowed" name="commercialUse" value="true" class="form-radio">
                        Allowed
                    </label>
                    <label class="radio-label">
                        <input type="radio" id="editCommercialUseNotAllowed" name="commercialUse" value="false" class="form-radio">
                        Not allowed
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label for="editProjects" class="form-label">Projects (comma-separated):</label>
                <input type="text" id="editProjects" name="projects" placeholder="e.g., website, branding, print" class="form-input">
            </div>
            <div class="form-group">
                <label for="editTags" class="form-label">Tags (comma-separated):</label>
                <input type="text" id="editTags" name="tags" placeholder="e.g., serif, display, modern" class="form-input">
            </div>
            <button type="submit" class="upload-button">Update Font</button>
        </form>
        <div id="editStatus" class="upload-status"></div>
        </div>
    </dialog>
    {{range .}}
    <div class="font-item">
        <div class="font-header">
            <div class="font-title">
                <span class="font-name">{{.Name}}</span>
                <span class="font-filename">{{.Filename}}</span>
            </div>
            <div class="font-actions">
                <div class="metadata">
                    <span class="metadata-item">
                        {{if and .Metadata.Source (or (hasPrefix .Metadata.Source "http://") (hasPrefix .Metadata.Source "https://"))}}
                            <a href="{{.Metadata.Source}}" target="_blank" rel="noopener noreferrer">{{extractDomain .Metadata.Source}}</a>
                        {{else}}
                            {{.Metadata.Source}}
                        {{end}}
                    </span>
                    <span class="pill {{if .Metadata.CommercialUse}}commercial-use-pill{{else}}personal-use-pill{{end}}">{{if .Metadata.CommercialUse}}Commercial use{{else}}Personal use only{{end}}</span>
                    {{if .Metadata.Projects}}
                        {{range .Metadata.Projects}}<span class="pill project-pill">{{.}}</span>{{end}}
                    {{end}}
                    {{if .Metadata.Tags}}
                        {{range .Metadata.Tags}}<span class="pill tag-pill">{{.}}</span>{{end}}
                    {{end}}
                </div>
                <button class="edit-btn" onclick="openEditModal('{{.Filename}}', '{{.Name}}', '{{.Metadata.Source}}', {{.Metadata.CommercialUse}}, '{{range .Metadata.Projects}}{{.}},{{end}}', '{{range .Metadata.Tags}}{{.}},{{end}}')">Edit</button>
            </div>
        </div>
        <div class="preview" style="font-family: '{{.Name}}';">The quick brown fox jumps over the lazy dog</div>
    </div>
    {{end}}
</body>
</html>
